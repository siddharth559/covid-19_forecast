'''
Author: Siddharth Acharya
Title : India's COvid-19 second wave decline forecast
'''

actual_case_increase = [20159, 18144, 16678, 16278, 17909, 20472, 18123, 18453, 18820, 16086, 12481, 15903, 17015, 15677, 15155, 15050, 13962, 9987, 13787, 15279, 14495, 14323, 14896, 13232, 9098, 12733, 11556, 18912, 13054, 13073, 11527, 8579, 11001, 12925, 12401, 11711, 12069, 11786, 8715, 10731, 12539, 9353, 12137, 12198, 11706, 9086, 11592, 12862, 13237, 13916, 13919, 14278, 10494, 13682, 16930, 16599, 16562, 16805, 15614, 12270, 14998, 17425, 16824, 18324, 18724, 18650, 15353, 17873, 22851, 23298, 24845, 25154, 26513, 24437, 28869, 35838, 39687, 40906, 43815, 47009, 40636, 47239, 53419, 59083, 62276, 62632, 68206, 56152, 53237, 72113, 81398, 89023, 92994, 103794, 96563, 115312, 126276, 131878, 144945, 152565, 169914, 160838, 185297, 199584, 216828, 234002, 260895, 275063, 257003, 294365, 315752, 332531, 345296, 348996, 354658, 319471, 362913, 379404, 386773, 402014, 392576, 370090, 355769, 382847, 412624, 414280, 406901, 403808, 366455, 329491, 348555, 362632, 343005, 326256, 310757, 281837, 263021, 267246, 276193, 259242, 257299, 240897, 222834, 195857, 208992, 211510, 186075, 174083, 165282, 153396, 126649, 133152, 134044, 132424, 120454, 114488, 101209, 85804, 92787, 93883, 91849, 84574, 80487,71001,59958,62215,67289,62436,60765,58615, 52978, 42683, 50817, 54296,51659, 48768, 49844, 46523, 37012,46104, 48606, 46781, 44187, 43027, 40150, 34026, 43964, 45701, 43504, 42660,41494, 37654, 30818, 40314, 41759, 39071, 38117, 41283, 38330, 29420, 42128, 41687, 34863, 39501, 40286, 38179, 30820, 42971, 43165, 44671, 41499, 41943, 40629, 30085]

actual_recovery_increase = [23838, 20903, 19658, 29209, 21161, 19689, 20503, 19242, 19460, 16737, 18578, 17762, 17797, 15943, 16809, 17202, 14513, 17127, 17229, 20071, 17734, 17166, 16033, 13148, 16092, 13250, 14261, 20315, 14886, 14077, 11882, 13443, 14250, 17813, 15788, 14512, 11761, 11756, 13600, 12928, 11796, 15722, 11358, 11107, 9500, 11793, 11836, 12028, 10914, 10214, 11413, 9715, 13233, 13969, 12100, 12222, 12790, 11709, 11291, 12472, 13113, 14071, 13788, 14186, 14379, 14303, 16606, 20643, 18154, 15092, 19972, 16508, 17590, 20186, 17746, 17793, 20356, 23623, 22971, 21205, 29779, 23913, 26575, 32917, 30341, 28728, 32269, 36989, 41242, 40423, 50384, 44179, 60059, 52840, 50100, 59714, 59137, 61829, 77263, 90328, 75380, 96746, 82271, 93425, 117897, 122886, 138209, 143839, 154357, 166656, 179434, 192317, 220545, 215809, 218626, 249009, 262349, 274171, 291727, 299198, 308688, 300004, 318910, 337699, 330718, 328349, 327675, 386395, 353777, 355930, 355398, 352005, 344676, 353200, 362547, 378526, 422391, 389758, 369005, 357173, 357625, 355138, 302253, 326737, 295264, 283054, 271002, 285332, 264483, 237664, 254879,231397, 211890, 206722, 197763, 189374, 174156, 182866, 162356, 149022, 135329, 122685, 132664, 119574, 117232,107776,103900,88500,97854,87608,78189,82031,68697,69162,64369, 64819, 57866, 58563, 57016, 60789, 61813, 59054, 57497, 52270, 42342, 51933, 47054, 44529, 44204, 45291, 39293, 39827, 43878, 42051, 38545, 45356, 36876, 38891, 38403, 35144, 40038, 35945, 42503, 41653, 38537, 42115, 37320, 39485, 36628, 39120]

#second dose (data till july)
vaccinated= [20859, 21911, 142489, 239626, 318541, 475776, 717941, 884608, 893795, 1174416, 1309475, 1525390, 1972882, 2419557, 2419557, 2419557, 2419557, 2647634, 2830557, 3142165, 3455761, 3732333, 3747137, 4062362, 4357037, 4665762, 4749612, 5160140, 5460862, 5480034, 5851784, 6161488, 6484692, 6817469, 7080848, 7308880, 7341914, 7592019, 7824277, 7966046, 8134520, 8271851, 8370120, 8377533, 8408775, 8560886, 8746787, 8918256, 9154083, 9368419, 9567193, 9819655, 10029697, 10428815, 10883431, 11286572, 11657482, 11888873, 12410952, 12774675, 13209592, 13744355, 14378048, 15020960, 15310668, 16278588, 17263653, 17972744, 19170339, 20197122, 21080613, 21390165, 22638695, 23615946, 24515213, 25456864, 26621155, 27297355, 27507360, 28385461, 29122833, 30200597, 31544713, 32895173, 34127375, 34450192, 35906905, 37305298, 38240332, 39274256, 39784951, 40412424, 40486671, 40726986, 40921402, 41076994, 41262233, 41450129, 41633995, 41697052, 41874876, 42079031, 42235974, 42431761, 42665859, 42992369, 43084719, 43384966, 43674110, 43912247, 44153937, 44436944, 44711155, 44799620, 45129717, 45449492, 45770830, 46099387, 46434361, 46825911, 46951231, 47378599, 47789089, 48173116, 48592637, 48994708, 49516745, 49806985, 50602957, 51276230, 51947641, 52769970, 53667519, 54829892, 55183554, 56350540, 57293198, 58066442, 59070842, 60314554, 62527005, 63015764, 64823481, 66060084, 67401699, 68752879, 69894633, 71301249, 71774807, 73292746, 74735268]

#data from 1 jan (till 31st may)

tested = [173111694, 173941658, 174899783, 175635761, 176531997, 177463405, 178400995, 179336364, 180253315, 181096622, 181755831, 182652887, 183489114, 184232305, 184962401, 185765491, 186544868, 187093036, 187802827, 188566947, 189347782, 190148024, 190985119, 191766871, 192337117, 193062694, 193613120, 194338773, 195081079, 195837408, 196588372, 197092635, 197752057, 198473178, 199216019, 199931795, 200672589, 201368378, 201900614, 202587752, 203324655, 204023840, 204789784, 205533398, 206230512, 206716634, 207332298, 207977229, 208703791, 209474862, 210261480, 210931530, 211551746, 212230431, 213036275, 213829658, 214661465, 215435383, 216231106, 216858774, 217618057, 218403277, 219178908, 219940742, 220692677, 221430507, 221968271, 222716796, 223479877, 224258293, 224998638, 225839273, 226703641, 227407413, 228280763, 229249784, 230313163, 231370546, 232431517, 233565119, 234445774, 235413233, 236438861, 237503882, 238604638, 239769553, 240950842, 241864161, 242650025, 243672940, 244798621, 245912587, 246959192, 248125908, 249019657, 250231269, 251439598, 252677379, 254041584, 255214803, 256626850, 257806986, 259207108, 260618866, 262003415, 263476625, 264972022, 266538416, 267894549, 269414035, 271053392, 272705103, 274445653, 276199222, 277918810, 279321177, 280979877, 282703789, 284471979, 286392086, 288337385, 290142339, 291647037, 293310779, 294852078, 296775209, 298601699, 300410043, 302275471, 303750077, 305600187, 307583991, 309448585, 311324100, 313017193, 314850143, 316423658, 318292881, 320301177, 322356187, 324417870, 326484155, 328607937, 330536064, 332594176, 334811496, 336969353, 339039861, 341119909, 343183748, 344866883]
total_cases = [10306393, 10324537, 10341215, 10357493, 10375402, 10395874, 10413997, 10432450, 10451270, 10467356, 10479837, 10495740, 10512755, 10528432, 10543587, 10558637, 10572599, 10582586, 10596373, 10611652, 10626147, 10640470, 10655366, 10668598, 10677696, 10690429, 10701985, 10720897, 10733951, 10747024, 10758551, 10767130, 10778131, 10791056, 10803457, 10815168, 10827237, 10839023, 10847738, 10858469, 10871008, 10880361, 10892498, 10904696, 10916402, 10925488, 10937080, 10949942, 10963179, 10977095, 10991014, 11005292, 11015786, 11029468, 11046398, 11062997, 11079559, 11096364, 11111978, 11124248, 11139246, 11156671, 11173495, 11191819, 11210543, 11229193, 11244546, 11262419, 11285270, 11308568, 11333413, 11358567, 11385080, 11409517, 11438386, 11474224, 11513911, 11554817, 11598632, 11645641, 11686277, 11733516, 11786935, 11846018, 11908294, 11970926, 12039132, 12095284, 12148521, 12220634, 12302032, 12391055, 12484049, 12587843, 12684406, 12799718, 12925994, 13057872, 13202817, 13355382, 13525296, 13686134, 13871431, 14071015, 14287843, 14521845, 14782740, 15057803, 15314806, 15609171, 15924923, 16257454, 16602750, 16951746, 17306404, 17625875, 17988788, 18368192, 18754965, 19156979, 19549555, 19919645, 20275414, 20658261, 21070885, 21485165, 21892066, 22295874, 22662329, 22991820, 23340375, 23703007, 24046012, 24372268, 24683025, 24964862, 25227883, 25495129, 25771322, 26030564, 26287863, 26528760, 26751594, 26947451, 27156443, 27367953, 27554028, 27728111, 27893393, 28046789, 28173438]
case_increase = [20159, 18144, 16678, 16278, 17909, 20472, 18123, 18453, 18820, 16086, 12481, 15903, 17015, 15677, 15155, 15050, 13962, 9987, 13787, 15279, 14495, 14323, 14896, 13232, 9098, 12733, 11556, 18912, 13054, 13073, 11527, 8579, 11001, 12925, 12401, 11711, 12069, 11786, 8715, 10731, 12539, 9353, 12137, 12198, 11706, 9086, 11592, 12862, 13237, 13916, 13919, 14278, 10494, 13682, 16930, 16599, 16562, 16805, 15614, 12270, 14998, 17425, 16824, 18324, 18724, 18650, 15353, 17873, 22851, 23298, 24845, 25154, 26513, 24437, 28869, 35838, 39687, 40906, 43815, 47009, 40636, 47239, 53419, 59083, 62276, 62632, 68206, 56152, 53237, 72113, 81398, 89023, 92994, 103794, 96563, 115312, 126276, 131878, 144945, 152565, 169914, 160838, 185297, 199584, 216828, 234002, 260895, 275063, 257003, 294365, 315752, 332531, 345296, 348996, 354658, 319471, 362913, 379404, 386773, 402014, 392576, 370090, 355769, 382847, 412624, 414280, 406901, 403808, 366455, 329491, 348555, 362632, 343005, 326256, 310757, 281837, 263021, 267246, 276193, 259242, 257299, 240897, 222834, 195857, 208992, 211510, 186075, 174083, 165282, 153396, 126649]
recoverd = [9905403, 9926306, 9945964, 9975173, 9996334, 10016023, 10036526, 10055768, 10075228, 10091965, 10110543, 10128305, 10146102, 10162045, 10178854, 10196056, 10210569, 10227696, 10244925, 10264996, 10282730, 10299896, 10315929, 10329077, 10345169, 10358419, 10372680, 10392995, 10407881, 10421958, 10433840, 10447283, 10461533, 10479346, 10495134, 10509646, 10521407, 10533163, 10546763, 10559691, 10571487, 10587209, 10598567, 10609674, 10619174, 10630967, 10642803, 10654831, 10665745, 10675959, 10687372, 10697087, 10710320, 10724289, 10736389, 10748611, 10761401, 10773110, 10784401, 10796873, 10809986, 10824057, 10837845, 10852031, 10866410, 10880713, 10897319, 10917962, 10936116, 10951208, 10971180, 10987688, 11005278, 11025464, 11043210, 11061003, 11081359, 11104982, 11127953, 11149158, 11178937, 11202850, 11229425, 11262342, 11292683, 11321411, 11353680, 11390669, 11431911, 11472334, 11522718, 11566897, 11626956, 11679796, 11729896, 11789610, 11848747, 11910576, 11987839, 12078167, 12153547, 12250293, 12332564, 12425989, 12543886, 12666772, 12804981, 12948820, 13103177, 13269833, 13449267, 13641584, 13862129, 14077938, 14296564, 14545573, 14807922, 15082093, 15373820, 15673018, 15981706, 16281710, 16600620, 16938319, 17269037, 17597386, 17925061, 18311456, 18665233, 19021163, 19376561, 19728566, 20073242, 20426442, 20788989, 21167515, 21589906, 21979664, 22348669, 22705842, 23063467, 23418605, 23720858, 24047595, 24342859, 24625913, 24896915, 25182247, 25446730, 25684394, 25939273]
recovery_increase = [23838, 20903, 19658, 29209, 21161, 19689, 20503, 19242, 19460, 16737, 18578, 17762, 17797, 15943, 16809, 17202, 14513, 17127, 17229, 20071, 17734, 17166, 16033, 13148, 16092, 13250, 14261, 20315, 14886, 14077, 11882, 13443, 14250, 17813, 15788, 14512, 11761, 11756, 13600, 12928, 11796, 15722, 11358, 11107, 9500, 11793, 11836, 12028, 10914, 10214, 11413, 9715, 13233, 13969, 12100, 12222, 12790, 11709, 11291, 12472, 13113, 14071, 13788, 14186, 14379, 14303, 16606, 20643, 18154, 15092, 19972, 16508, 17590, 20186, 17746, 17793, 20356, 23623, 22971, 21205, 29779, 23913, 26575, 32917, 30341, 28728, 32269, 36989, 41242, 40423, 50384, 44179, 60059, 52840, 50100, 59714, 59137, 61829, 77263, 90328, 75380, 96746, 82271, 93425, 117897, 122886, 138209, 143839, 154357, 166656, 179434, 192317, 220545, 215809, 218626, 249009, 262349, 274171, 291727, 299198, 308688, 300004, 318910, 337699, 330718, 328349, 327675, 386395, 353777, 355930, 355398, 352005, 344676, 353200, 362547, 378526, 422391, 389758, 369005, 357173, 357625, 355138, 302253, 326737, 295264, 283054, 271002, 285332, 264483, 237664, 254879]
deaths = [148664, 148880, 149095, 149295, 149560, 149782, 150015, 150244, 150457, 150607, 150773, 150973, 151174, 151363, 151539, 151720, 151865, 152002, 152164, 152316, 152477, 152630, 152786, 152917, 153033, 153171, 153294, 153456, 153593, 153721, 153837, 153931, 154044, 154151, 154271, 154366, 154441, 154527, 154605, 154699, 154809, 154894, 154998, 155087, 155178, 155260, 155359, 155459, 155559, 155659, 155748, 155831, 155907, 156010, 156151, 156270, 156384, 156495, 156603, 156695, 156793, 156880, 156993, 157102, 157202, 157299, 157375, 157508, 157633, 157752, 157892, 158051, 158171, 158301, 158488, 158659, 158815, 159003, 159199, 159412, 159609, 159886, 160135, 160392, 160684, 160995, 161290, 161556, 161911, 162369, 162837, 163550, 164064, 164541, 164987, 165617, 166301, 167103, 167876, 168714, 169618, 170498, 171524, 172562, 173746, 175084, 176582, 178202, 179959, 181980, 184081, 186338, 188958, 191719, 194527, 197289, 200575, 204221, 207723, 211248, 214933, 218356, 221795, 225581, 229560, 233483, 237716, 241808, 245557, 249436, 253634, 257762, 261762, 265651, 269728, 273826, 278160, 282689, 286566, 290775, 294969, 298708, 303162, 306671, 310831, 314674, 318333, 321944, 325407, 328537, 331318]
death_increase = [237, 216, 215, 200, 265, 222, 233, 229, 213, 150, 166, 200, 201, 189, 176, 181, 145, 137, 162, 152, 161, 153, 156, 131, 116, 138, 123, 162, 137, 128, 116, 94, 113, 107, 120, 95, 75, 86, 78, 94, 110, 85, 104, 89, 91, 82, 99, 100, 100, 100, 89, 83, 76, 103, 141, 119, 114, 111, 108, 92, 98, 87, 113, 109, 100, 97, 76, 133, 125, 119, 140, 159, 120, 130, 187, 171, 156, 188, 196, 213, 197, 277, 249, 257, 292, 311, 295, 266, 355, 458, 468, 713, 514, 477, 446, 630, 684, 802, 773, 838, 904, 880, 1026, 1038, 1184, 1338, 1498, 1620, 1757, 2021, 2101, 2257, 2620, 2761, 2808, 2762, 3286, 3646, 3502, 3525, 3685, 3423, 3439, 3786, 3979, 3923, 4233, 4092, 3749, 3879, 4198, 4128, 4000, 3889, 4077, 4098, 4334, 4529, 3877, 4209, 4194, 3739, 4454, 3509, 4160, 3843, 3659, 3611, 3463, 3130, 2781]

P = 1200000000 #population of india
print('before',len(case_increase))
#
#DI = k( I - R )( P - I )  [neglecting deaths and reinfection rates  and assuming the govt figures are correct]
#DR = Q( I - D - R )
#Dd = C( I )

K=Q=C=1

import numpy as np 

u = np.array(tested[:len(tested)-1])
i = np.array(total_cases[:len(total_cases)-1])
di = np.array(case_increase[74:])
r = np.array(recoverd[:len(recoverd)-1])
dr = np.array(recovery_increase[74:])
d = np.array(deaths[:len(deaths)-1])
dd = np.array(death_increase[74:])

print(len(i),len(r),len(di))


#we need to subtract a little to avoid the impact of first wave on our analysis
dev_var = 1.0005
i = i-i[71]/dev_var  # I took the value from 71st day from 1st Jan (experimental) 
i=i[73:]  # after subtracting value at certain places I-R starts coming out negetive so we neglect them
r = r-r[71]/dev_var
r= r[73:]
d = d-d[71]/dev_var
d=d[73:]

print(len(i),len(r),len(di))
for ij in range(len(i)):
	if i[ij]-r[ij] < 0:
		print(ij,end = '\\\\')
weights = [(2*2.77**(2*i)) for i in range(77)]

s = di/((i-r)*(P-i))
K = np.sum(s*weights)/np.sum(weights)

q = dr/(i-d-r)
Q = np.sum(q*weights)/np.sum(weights)

c = dd/i
C = np.sum(c*weights)/np.sum(weights)


#print(K,Q,C)
#print(total_cases[-1])
#print(K*(total_cases[-1]-total_cases[71]/dev_var - (recoverd[-1]-recoverd[71]/dev_var))*(P - (total_cases[-1]-total_cases[71]/dev_var)))
#print(Q*( (total_cases[-1] - total_cases[71]/dev_var) - ( deaths[-1] - deaths[71]/dev_var ) - ( recoverd[-1] - recoverd[71]/dev_var )))



#for for future
for jk in range(100):
	case_increase.append(K*(total_cases[-1]-total_cases[71]/dev_var - (recoverd[-1]-recoverd[71]/dev_var))*(P - (total_cases[-1]-total_cases[71]/dev_var)))
	total_cases.append(total_cases[-1]+case_increase[-1])
	recovery_increase.append(Q*( (total_cases[-1] - total_cases[71]/dev_var) - ( deaths[-1] - deaths[71]/dev_var ) - ( recoverd[-1] - recoverd[71]/dev_var )))
	recoverd.append(recoverd[-1]+recovery_increase[-1])
	death_increase.append(C*(total_cases[-1]-total_cases[71]/dev_var))
	deaths.append(deaths[-1]+death_increase[-1])
#print(case_increase)
import matplotlib.pyplot as pl


error_array = [[],[]]
for i in range(63):
	error_array[0].append((actual_case_increase[151:214][i] - case_increase[151:214][i])/actual_case_increase[151:214][i]*100)
	if i < 59:
		error_array[1].append((actual_recovery_increase[151:210][i] - recovery_increase[151:210][i])/actual_recovery_increase[151:210][i]*100)


pl.rcParams['figure.figsize'] = [10,10]
pl.title('covid-19 india data \n cases forecast accuracy = {} \n recovery forecast accuracy = {}'.format(100-np.average(error_array[0]).__round__(4),100-np.average(error_array[1]).__round__(4)))
pl.plot(case_increase,label="forecasted cases")
#pl.plot(total_cases)
pl.plot(recovery_increase, label="forecasted recovery")
pl.plot(actual_case_increase, label="actual cases")
pl.plot(actual_recovery_increase, label="actual recovery")
pl.legend()
pl.show()






